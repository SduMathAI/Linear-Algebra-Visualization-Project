# 技术报告


## 项目概述

本项目面向线性代数教学场景，提供“几何可视化 + AI 助教”一体化体验：
- 前端：单页 Canvas 应用 [index.html](index.html)，内置点/向量/矩阵对象、动画和聊天窗。用户可直接拖拽、组合变换并观看 SVD、特征值等可视化。
- 后端：Flask 服务 [backend/app.py](backend/app.py)，基于 DeepSeek Chat 将自然语言请求转为结构化 JSON 指令（`operation`、`inputs`、`visualization_config`、可选 `lean` 提示），前端据此自动生成场景并展示解释。
- 辅助脚本：
  - [backend/example_scenarios.py](backend/example_scenarios.py) 演示如何调用 `/chat`。
  - [backend/verify_agent.py](backend/verify_agent.py) 使用 `unittest.mock` 自检 JSON 解析与 Markdown 剥离逻辑。

## 系统架构

整体采用“前端单页 + 后端 API + LLM 服务”三层设计：

1) 前端层（可视化与交互）
    - 单文件 HTML/JS/CSS，使用 `<canvas>` 绘制网格、向量、矩阵、特征系和 SVD 动画。
    - 内置 `MathLib`（矩阵/特征值/SVD 计算）、`HistoryManager`（撤销/重做与状态快照）、`AnimationEngine`（分段补间）、`AIBridge`（解析后端 JSON 并构造场景）。
    - 聊天窗口可拖拽，支持 Markdown 渲染，指令驱动自动生成演示场景。

2) 后端层（核心逻辑）
    - 基于 Flask 的 `/chat` API，接受 `{ "message": "..." }`。
    - 通过 DeepSeek Chat 按 `SYSTEM_PROMPT` 输出统一 JSON 结构；若模型返回 Markdown 代码块会剥离后再 `json.loads`，失败时返回 `operation: other` 兜底。
    - 提供 Lean 占位字段（`lean.statement_cn/lean_code/hint`），便于扩展正式证明检查。

3) 服务支持层
    - DeepSeek API：负责自然语言解析与 JSON 指令生成。
    - 单元测试：`verify_agent.py` 用 Mock 校验接口输出；`example_scenarios.py` 作为最小客户端示例。

交互流程：用户在前端输入请求 → 前端调用 `/chat` → 后端 LLM 生成 JSON → 前端据指令重置或创建对象并展示解释/Lean 提示 → 用户继续拖拽/修改矩阵观察效果。
## 模块功能

1) API 接口模块
    - `POST /chat`：接收自然语言请求，返回统一 JSON（operation、inputs、visualization_config、explanation，可选 lean）。
    - 解析 LLM 返回内容，自动去除 Markdown 代码块，解析失败时兜底返回原始文本。

2) LLM 交互模块
    - DeepSeek Chat 客户端，按 `SYSTEM_PROMPT` 生成可视化指令和交互引导。
    - 支持默认矩阵/向量补全（未指定时给出简单 2x2 示例）。

3) 可视化与动画模块（前端）
    - `MathLib`：向量线性组合、矩阵乘法、特征值、SVD、网格吸附。
    - `SceneObject` 族：Point/Vector/Matrix/EigenSystem/LinearComb/TransformedVector/TransformedMatrix，支持选中、高亮、依赖跟随更新。
    - `HistoryManager`：撤销/重做，状态序列化，限制 50 级历史。
    - `AnimationEngine`：驱动矩阵变换与 SVD 分三段动画（Vᵀ 旋转 → Σ 拉伸 → U 旋转）。

4) Lean 展示模块
    - 接收 `lean` 字段并在聊天区以卡片形式展示中文陈述、代码片段与提示。
    - 目前为占位演示，便于后续接入真实 Lean 编译/验证。

## 小组分工

- 组长：崔添
    - 组织选题、主持组会
    - 协调各模块开发进度

- 前端开发（6 人）
    - 项目经理（1 人）：吴叶轩
        - 前端整体框架设计与优化
        - 综合技术顾问
        - 部署网页和服务器
    - 页面组（2 人）：刘瀚文 王宇坤
        - 设计并实现用户交互界面,开发线性代数元素的可视化组件
    - 逻辑组（3 人）：孙文博 闫百涵 刘翔
        - 实现前端的动画逻辑
        - 实现数学可视化四个命题的具体组件

- 后端开发（3 人）：崔添 房玉坤 周少鹏
    - 算法、LLM 集成和前后端通信： 崔添
    - 优化设计系统提示词 ：崔添 房玉坤 周少鹏

- 撰写技术报告与答辩PPT（1 人）：左明冉

>  Main contributor： 吴叶轩 崔添

## 部署方法
1) 环境准备
     - Python 3.9+。
     - 复制 `backend/.env.example` 为 `.env`，写入 `DEEPSEEK_API_KEY=<你的 key>`。
     - 安装依赖：`pip install -r backend/requirements.txt`（包含 flask、flask-cors、openai、python-dotenv）。

2) 启动后端
```bash
cd backend
python app.py  # 默认监听 http://127.0.0.1:5500/chat
```

3) 启动前端
- 直接用浏览器打开项目根目录的 [index.html](index.html)；或用任意静态服务器（需允许访问 127.0.0.1:5500）。
- 聊天框默认请求 `http://127.0.0.1:5500/chat`，确保端口一致。

4) 快速自测
- 浏览器聊天输入：“为我展示矩阵的 SVD 分解和矩阵乘法的几何意义”，应生成矩阵作用向量的动画。
- 命令行：
```bash
curl -X POST http://127.0.0.1:5500/chat \
    -H "Content-Type: application/json" \
    -d '{"message":"展示矩阵 svd 分解"}'
```

## 功能演示

### 1.基础功能入门
> 矩阵，向量创建与拖动：鼠标左键创建选择，选择点按住鼠标左键拖动，注意有自动吸附（阈值0.25，可按Alt键取消）

![avatar](Attachments/GIF%202025-12-29%2012-26-52.gif)

>界面基础操作：平移，缩放 按住鼠标中键进行画板拖动，按住Ctrl键滑动鼠标中键滚动调节大小

![avatar](Attachments/GIF%202025-12-29%2012-55-06.gif)
### 2.线性变换动态演示
>旋转的演示

![avatar](Attachments/GIF%202025-12-29%2013-11-27.gif)
>缩放矩阵对图形的拉伸效果

![avatar](Attachments/GIF%202025-12-29%2013-18-13.gif)
>剪切矩阵对图形的扭曲效果 （SVD 分解）

![avatar](Attachments/GIF%202025-12-29%2013-20-56.gif)
### 3.矩阵运算可视化
>矩阵乘法运算的复合变换效果

![avatar](Attachments/GIF%202025-12-29%2013-29-55.gif)
### 4.向量线性组合演示
>**这里是线性组合演示** ：固定两个基向量$v=(1,0)$和$w=(0,1)$，通过调整系数$a$和$b$（如$a=2, b=3$），实时展示$a*v + b*w$

>这是拖动滑块的效果
![avatar](Attachments/GIF%202025-12-29%2013-33-33.gif)

>这是按0.1分度更改系数或键入系数的效果
![avatar](Attachments/GIF%202025-12-29%2016-37-13.gif)

>这是滑动演示向量三角形
![avatar](Attachments/GIF%202025-12-29%2013-35-14.gif)


## 七、组会记录
详见 [组会日志.md](组会日志.md)